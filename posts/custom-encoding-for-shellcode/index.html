<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Custom Encoding For Shellcode" /><meta name="author" content="Matt C" /><meta property="og:locale" content="en" /><meta name="description" content="Tired of your payloads constantly getting detected? Tried MSFVenom and still have had no luck with making it past EDR?&nbsp; Then read on for to how to make your own encoder. Preface: Before we get into the weeds, I have to credit the project that this was heavily based on by ired.team. It can be found by following the hyperlink. I took it one step further by combining it into one Windows based script and showing applications as well as analyzing the detection&#39;s. Now onto the fun: The code for the project can be found here. One should have familiarity with Powershell and hex while working through this. Knowledge of assembly isn&#39;t required, but things will make more sense with it. ired.team should be credited for heavily for all of this, but especially for commenting the assembly file, it helps a lot with understand it. The first step is to encode our hex payload. For this we will use Powershell. We run through the hex encoded string and XOR it, add to it, and then XOR it again, before returning the new encoded string. Running this returns our new encoded string and the size of it.&nbsp; The size is needed for our assembly to properly know how many bytes to process.&lt;p&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;With the size and newly encoded shellcode, we can then move on to our assembly file. &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;This is a quick assembly file that loops through our encoding scheme in reverse. The math operations happen in reverse of what we use in our encoding scheme because we want to generate instructions for undoing it. This way, when we compile our code, we get back the encoded shellcode as well as the assembly operations for decoding it. We can run it through nasm nasm -f win64 .\decode.asm -o Decode and examine the output in CFF Explorer. This looks like below. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;The highlighted section starts at EB 1E and, you might notice, ends at the last character of our payload, 3F 20. This blocks includes our decode scheme and our encoded payload. So when we load the payload into an application, it knows how to decode it as shown below. The encoded version is on the left and the decoded is on the right.&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 style=&quot;text-align: left;&quot;&gt;Applying what we’ve done:&lt;/h3&gt;&lt;p&gt;With this shellcode, we can insert it into an application using something like Frampton.  &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Frampton is a tool to insert shellcode into code caves within applications. Code caves are a whole different topic to get into but the long and short of it is that after compiling programs there’s empty space left over. This space can be filled with our code that’s either pointing to an external resource or by finding a cave large enough to fit our whole payload. Once Frampton finds and inserts into this code cave, it changes the execution point to start where our cave is filled, and works from there.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;It’s not super elegant because we’re not controlling where the code cave is, it makes file sections that are normally not executable now executable, and the application flow doesn’t work as you might normally expect afterwards. Because the PE has a new entry point outside of the .text section, which is normally the only executable section of a file, AV has a higher chance of flagging it as malicious.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;h3&gt;Analyzing detection:&lt;/h3&gt;&lt;p style=&quot;text-align: left;&quot;&gt;We’ve inserted our encoded shellcode into an application and made it executable. So what does the Virustotal detection look like? &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Just about all the vendors are detecting the invalid signature in PuTTY now since we’ve changed the file and the remaining vendors are detecting the unusual entry point. Compare this with the detection of the same payload encoded using Shikata Ga Nai. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;We can see a big jump in detections as well as some vendors identifying the specific encoding scheme used.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" /><meta property="og:description" content="Tired of your payloads constantly getting detected? Tried MSFVenom and still have had no luck with making it past EDR?&nbsp; Then read on for to how to make your own encoder. Preface: Before we get into the weeds, I have to credit the project that this was heavily based on by ired.team. It can be found by following the hyperlink. I took it one step further by combining it into one Windows based script and showing applications as well as analyzing the detection&#39;s. Now onto the fun: The code for the project can be found here. One should have familiarity with Powershell and hex while working through this. Knowledge of assembly isn&#39;t required, but things will make more sense with it. ired.team should be credited for heavily for all of this, but especially for commenting the assembly file, it helps a lot with understand it. The first step is to encode our hex payload. For this we will use Powershell. We run through the hex encoded string and XOR it, add to it, and then XOR it again, before returning the new encoded string. Running this returns our new encoded string and the size of it.&nbsp; The size is needed for our assembly to properly know how many bytes to process.&lt;p&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;With the size and newly encoded shellcode, we can then move on to our assembly file. &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;This is a quick assembly file that loops through our encoding scheme in reverse. The math operations happen in reverse of what we use in our encoding scheme because we want to generate instructions for undoing it. This way, when we compile our code, we get back the encoded shellcode as well as the assembly operations for decoding it. We can run it through nasm nasm -f win64 .\decode.asm -o Decode and examine the output in CFF Explorer. This looks like below. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;The highlighted section starts at EB 1E and, you might notice, ends at the last character of our payload, 3F 20. This blocks includes our decode scheme and our encoded payload. So when we load the payload into an application, it knows how to decode it as shown below. The encoded version is on the left and the decoded is on the right.&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 style=&quot;text-align: left;&quot;&gt;Applying what we’ve done:&lt;/h3&gt;&lt;p&gt;With this shellcode, we can insert it into an application using something like Frampton.  &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Frampton is a tool to insert shellcode into code caves within applications. Code caves are a whole different topic to get into but the long and short of it is that after compiling programs there’s empty space left over. This space can be filled with our code that’s either pointing to an external resource or by finding a cave large enough to fit our whole payload. Once Frampton finds and inserts into this code cave, it changes the execution point to start where our cave is filled, and works from there.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;It’s not super elegant because we’re not controlling where the code cave is, it makes file sections that are normally not executable now executable, and the application flow doesn’t work as you might normally expect afterwards. Because the PE has a new entry point outside of the .text section, which is normally the only executable section of a file, AV has a higher chance of flagging it as malicious.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;h3&gt;Analyzing detection:&lt;/h3&gt;&lt;p style=&quot;text-align: left;&quot;&gt;We’ve inserted our encoded shellcode into an application and made it executable. So what does the Virustotal detection look like? &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Just about all the vendors are detecting the invalid signature in PuTTY now since we’ve changed the file and the remaining vendors are detecting the unusual entry point. Compare this with the detection of the same payload encoded using Shikata Ga Nai. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;We can see a big jump in detections as well as some vendors identifying the specific encoding scheme used.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;" /><link rel="canonical" href="/posts/custom-encoding-for-shellcode/" /><meta property="og:url" content="/posts/custom-encoding-for-shellcode/" /><meta property="og:site_name" content="Culbert Report" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-03T01:22:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Custom Encoding For Shellcode" /><meta name="twitter:site" content="@mattculbert" /><meta name="twitter:creator" content="@Matt C" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Matt C"},"dateModified":"2022-09-06T19:34:41+00:00","datePublished":"2021-11-03T01:22:00+00:00","description":"Tired of your payloads constantly getting detected? Tried MSFVenom and still have had no luck with making it past EDR?&nbsp; Then read on for to how to make your own encoder. Preface: Before we get into the weeds, I have to credit the project that this was heavily based on by ired.team. It can be found by following the hyperlink. I took it one step further by combining it into one Windows based script and showing applications as well as analyzing the detection&#39;s. Now onto the fun: The code for the project can be found here. One should have familiarity with Powershell and hex while working through this. Knowledge of assembly isn&#39;t required, but things will make more sense with it. ired.team should be credited for heavily for all of this, but especially for commenting the assembly file, it helps a lot with understand it. The first step is to encode our hex payload. For this we will use Powershell. We run through the hex encoded string and XOR it, add to it, and then XOR it again, before returning the new encoded string. Running this returns our new encoded string and the size of it.&nbsp; The size is needed for our assembly to properly know how many bytes to process.&lt;p&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;With the size and newly encoded shellcode, we can then move on to our assembly file. &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;This is a quick assembly file that loops through our encoding scheme in reverse. The math operations happen in reverse of what we use in our encoding scheme because we want to generate instructions for undoing it. This way, when we compile our code, we get back the encoded shellcode as well as the assembly operations for decoding it. We can run it through nasm nasm -f win64 .\\decode.asm -o Decode and examine the output in CFF Explorer. This looks like below. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;The highlighted section starts at EB 1E and, you might notice, ends at the last character of our payload, 3F 20. This blocks includes our decode scheme and our encoded payload. So when we load the payload into an application, it knows how to decode it as shown below. The encoded version is on the left and the decoded is on the right.&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;h3 style=&quot;text-align: left;&quot;&gt;Applying what we’ve done:&lt;/h3&gt;&lt;p&gt;With this shellcode, we can insert it into an application using something like Frampton.  &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Frampton is a tool to insert shellcode into code caves within applications. Code caves are a whole different topic to get into but the long and short of it is that after compiling programs there’s empty space left over. This space can be filled with our code that’s either pointing to an external resource or by finding a cave large enough to fit our whole payload. Once Frampton finds and inserts into this code cave, it changes the execution point to start where our cave is filled, and works from there.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;It’s not super elegant because we’re not controlling where the code cave is, it makes file sections that are normally not executable now executable, and the application flow doesn’t work as you might normally expect afterwards. Because the PE has a new entry point outside of the .text section, which is normally the only executable section of a file, AV has a higher chance of flagging it as malicious.  &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;h3&gt;Analyzing detection:&lt;/h3&gt;&lt;p style=&quot;text-align: left;&quot;&gt;We’ve inserted our encoded shellcode into an application and made it executable. So what does the Virustotal detection look like? &lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;Just about all the vendors are detecting the invalid signature in PuTTY now since we’ve changed the file and the remaining vendors are detecting the unusual entry point. Compare this with the detection of the same payload encoded using Shikata Ga Nai. &lt;/p&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;/div&gt;&lt;p&gt;We can see a big jump in detections as well as some vendors identifying the specific encoding scheme used.&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;","headline":"Custom Encoding For Shellcode","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/custom-encoding-for-shellcode/"},"url":"/posts/custom-encoding-for-shellcode/"}</script><title>Custom Encoding For Shellcode | Culbert Report</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Culbert Report"><meta name="application-name" content="Culbert Report"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/thumb.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Culbert Report</a></div><div class="site-subtitle font-italic">Offensive security with a dash of becoming a better programmer. Art by Kenton Drumm</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/matt-culbert" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/mattculbert" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['matt','culbertreport.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Custom Encoding For Shellcode</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Custom Encoding For Shellcode</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1635902520" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 3, 2021 </em> </span> <span> Updated <em class="" data-ts="1662492881" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 6, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="621 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><h3 style="text-align: left;">Tired of your payloads constantly getting detected? Tried MSFVenom and still have had no luck with making it past EDR?&nbsp;</h3><h3 style="text-align: left;">Then read on for to how to make your own encoder.</h3><h4 style="text-align: left;">Preface: <br /></h4><p style="text-align: left;">Before we get into the weeds, I have to <a href="https://www.ired.team/offensive-security/code-injection-process-injection/writing-custom-shellcode-encoders-and-decoders#the-encoder-itself">credit the project</a> that this was heavily based on by ired.team. It can be found by following the hyperlink. I took it one step further by combining it into one Windows based script and showing applications as well as analyzing the detection's.</p><h3 style="text-align: left;">Now onto the fun:</h3><p style="text-align: left;">The code for the project <a href="https://github.com/matt-culbert/OffSec/blob/main/encode.ps1" target="_blank">can be found here</a>. One should have familiarity with Powershell and hex while working through this. Knowledge of assembly isn't required, but things will make more sense with it. ired.team should be credited for heavily for all of this, but especially for commenting the assembly file, it helps a lot with understand it.</p><p style="text-align: left;">The first step is to encode our hex payload. For this we will use Powershell. We run through the hex encoded string and XOR it, add to it, and then XOR it again, before returning the new encoded string.<br /></p><p style="text-align: left;"></p><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEg9vMZ32DpubnkYblqcYnjfuAzYuUIVZ83kriDNmRdOxty2T56ejb-wlF8BXjUOYdbXBsyR3fgbfEPc98MCOPqyOCE0mc9G3bmbu_HhOn1WBXS6Jfujw7MZ5JIDavET4ke48xnOel2i_3Yhd9Obb2DCHfAqFj2wAkm14M8vFENEbyyQ2jM45NqebPRyFA=s1260" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 481 179'%3E%3C/svg%3E" border="0" data-original-height="467" data-original-width="1260" height="179" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEg9vMZ32DpubnkYblqcYnjfuAzYuUIVZ83kriDNmRdOxty2T56ejb-wlF8BXjUOYdbXBsyR3fgbfEPc98MCOPqyOCE0mc9G3bmbu_HhOn1WBXS6Jfujw7MZ5JIDavET4ke48xnOel2i_3Yhd9Obb2DCHfAqFj2wAkm14M8vFENEbyyQ2jM45NqebPRyFA=w481-h179" width="481" class="lazyload" data-proofer-ignore></a></div><p>Running this returns our new encoded string and the size of it.&nbsp; <br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhIf337s88lGMUmMJM1axdFFajBmlmVxdz3mQi2xvKG-EGd1N_CzUdZlhWPeNMh3s6OuTH3QBywzP1ArgWAVO8DmBfcd8WbWUFq_waMR1l6OCSaDdslCz0Rhy1Nm8smsZfhyjVAnNRyFf-Oy3F0n84iZtbUGCV37u06gPW2V5J9PCfEzFDq2iWPr4eaPw=s1202" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 487 53'%3E%3C/svg%3E" border="0" data-original-height="133" data-original-width="1202" height="53" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEhIf337s88lGMUmMJM1axdFFajBmlmVxdz3mQi2xvKG-EGd1N_CzUdZlhWPeNMh3s6OuTH3QBywzP1ArgWAVO8DmBfcd8WbWUFq_waMR1l6OCSaDdslCz0Rhy1Nm8smsZfhyjVAnNRyFf-Oy3F0n84iZtbUGCV37u06gPW2V5J9PCfEzFDq2iWPr4eaPw=w487-h53" width="487" class="lazyload" data-proofer-ignore></a></div>The size is needed for our assembly to properly know how many bytes to process.<p></p><p style="text-align: left;">With the size and newly encoded shellcode, we can then move on to our assembly file.&nbsp;</p><p style="text-align: left;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjk52JZwXtZQTO2j_hQpLnHOQa1rj2zUIr-5Z1dlAa5YfmHJ_mrwo8b281R7zwcYi1hbuyE47pnRN94NAK6B4JanB-MOxRBkaSF2Z2ZzJTvl7M7Wo9WR0JFrGWxyIhvT0JG5ITI-p_AonWmtHzt662ZnK5YfgHlB5MVAtiSPZpEfwVPLDCQJWN2Rz9wFQ=s471" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 185 320'%3E%3C/svg%3E" border="0" data-original-height="471" data-original-width="272" height="320" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEjk52JZwXtZQTO2j_hQpLnHOQa1rj2zUIr-5Z1dlAa5YfmHJ_mrwo8b281R7zwcYi1hbuyE47pnRN94NAK6B4JanB-MOxRBkaSF2Z2ZzJTvl7M7Wo9WR0JFrGWxyIhvT0JG5ITI-p_AonWmtHzt662ZnK5YfgHlB5MVAtiSPZpEfwVPLDCQJWN2Rz9wFQ=s320" width="185" class="lazyload" data-proofer-ignore></a></div><p>This is a quick assembly file that loops through our encoding scheme in reverse. The math operations happen in reverse of what we use in our encoding scheme because we want to generate instructions for undoing it. This way, when we compile our code, we get back the encoded shellcode as well as the assembly operations for decoding it. We can run it through nasm <i>nasm -f win64 .\decode.asm -o Decode</i> and examine the output in CFF Explorer. This looks like below. <br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhIw0Um11BXXBqoDok3neZ-iuvTWA_9c_d8yw3l4UnuOkiMmeCe7_hDXssoZ7UMcNFzaOWPOFe9hDVH9gRxTFMXiAo0J0t3gBzd8tfOLW3M6jHyQjQ5d-A1Q-ESwvq1QWZadhMSALtPLRbToO-KR0ibqDD7jxxz6YAij97IcPlUgiblldFGXro00eaZ8A=s1203" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 446 279'%3E%3C/svg%3E" border="0" data-original-height="751" data-original-width="1203" height="279" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEhIw0Um11BXXBqoDok3neZ-iuvTWA_9c_d8yw3l4UnuOkiMmeCe7_hDXssoZ7UMcNFzaOWPOFe9hDVH9gRxTFMXiAo0J0t3gBzd8tfOLW3M6jHyQjQ5d-A1Q-ESwvq1QWZadhMSALtPLRbToO-KR0ibqDD7jxxz6YAij97IcPlUgiblldFGXro00eaZ8A=w446-h279" width="446" class="lazyload" data-proofer-ignore></a><br /></div><p>The highlighted section starts at <i>EB 1E </i>and, you might notice, ends at the last character of our payload, <i>3F 20</i>. This blocks includes our decode scheme and our encoded payload. So when we load the payload into an application, it knows how to decode it as shown below. The encoded version is on the left and the decoded is on the right.<br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjakm7RxcOAaB0IcRX-Av_1F_RuNhNawvTJBFAHc0upv7RetH7QGzqzycHuadVbrA5-Gb1PxMyKpu9SHrpDbBTSH9pJ8CUSp6Ey1OXnoJxbRgZ9MnrBCL_i99cBGLvqVYf79yxVhwmolc1j91bqBIx96t9SB35P-1vTx4iVplSSaD26_P-D3WWyfag52w=s1655" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 509 313'%3E%3C/svg%3E" border="0" data-original-height="1020" data-original-width="1655" height="313" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEjakm7RxcOAaB0IcRX-Av_1F_RuNhNawvTJBFAHc0upv7RetH7QGzqzycHuadVbrA5-Gb1PxMyKpu9SHrpDbBTSH9pJ8CUSp6Ey1OXnoJxbRgZ9MnrBCL_i99cBGLvqVYf79yxVhwmolc1j91bqBIx96t9SB35P-1vTx4iVplSSaD26_P-D3WWyfag52w=w509-h313" width="509" class="lazyload" data-proofer-ignore></a></div><p></p><p></p><h3 style="text-align: left;">Applying what we've done:<br /></h3><p>With this shellcode, we can insert it into an application using something like <a href="https://github.com/ins1gn1a/Frampton">Frampton</a>.&nbsp; <br /></p><p></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjzAvtWOxj4do5HMwhf4nTJ0bThfYfCHq5O-fBIQg3WniLX8k_-5TsNUK8yYTu8GntoeiBStX7WU4f2IMK-40MB3S3yKviG4ezFrdSpOEIRi1Abeg5JRjRt8G5xbZMiTDkuOOgd0ejaSARvZxSEhxt-sFdUthi2fup-n1ppC5_WzuNnsO5ULf5tmi6Ijg=s802" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 372 308'%3E%3C/svg%3E" border="0" data-original-height="663" data-original-width="802" height="308" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEjzAvtWOxj4do5HMwhf4nTJ0bThfYfCHq5O-fBIQg3WniLX8k_-5TsNUK8yYTu8GntoeiBStX7WU4f2IMK-40MB3S3yKviG4ezFrdSpOEIRi1Abeg5JRjRt8G5xbZMiTDkuOOgd0ejaSARvZxSEhxt-sFdUthi2fup-n1ppC5_WzuNnsO5ULf5tmi6Ijg=w372-h308" width="372" class="lazyload" data-proofer-ignore></a></div><p>Frampton is a tool to insert shellcode into code caves within applications. Code caves are a whole different topic to get into but the long and short of it is that after compiling programs there's empty space left over. This space can be filled with our code that's either pointing to an external resource or by finding a cave large enough to fit our whole payload. Once Frampton finds and inserts into this code cave, it changes the execution point to start where our cave is filled, and works from there.&nbsp; <br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjS3TPmH7yDZRAgkD8zQwCyFxGPVAS0d4ab-6ERrqcicMbdstGm9In09W2ILvQGV15RSJQgEjJLG54cEbw5GAPnvXymT6Z1InZjGGfgblNNAOB2YgIYTFkfEtFWKlPLKLyoRgDYuu9tzWGf1km4phPikhq1-6PT84jk7oV2FG_w5Y3wtxMUZ4cu2nZM_g=s891" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 364 299'%3E%3C/svg%3E" border="0" data-original-height="729" data-original-width="891" height="299" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEjS3TPmH7yDZRAgkD8zQwCyFxGPVAS0d4ab-6ERrqcicMbdstGm9In09W2ILvQGV15RSJQgEjJLG54cEbw5GAPnvXymT6Z1InZjGGfgblNNAOB2YgIYTFkfEtFWKlPLKLyoRgDYuu9tzWGf1km4phPikhq1-6PT84jk7oV2FG_w5Y3wtxMUZ4cu2nZM_g=w364-h299" width="364" class="lazyload" data-proofer-ignore></a><br /></div><p>It's not super elegant because we're not controlling where the code cave is, it makes file sections that are normally not executable now executable, and the application flow doesn't work as you might normally expect afterwards. Because the PE has a new entry point outside of the .text section, which is normally the only executable section of a file, AV has a higher chance of flagging it as malicious.&nbsp; <br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjuCc8GZcDFGJ1MtqZyLGVvcG46zqxiSgxKvnGjD5I3qpiCFEYfp5C1dNOSMX9FHpXCkI0oV6t783Ws141CDRXhFmWvLS1prPCHGI4j-tmwSdJY-MIMGI6A00esgrRf3_rawhCyhcp7TQ8Pw9nDBWPZl_kCYWELSnP2EmqaXyHfwJrfJYnUvFDPpuS2Nw=s1570" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 369 111'%3E%3C/svg%3E" border="0" data-original-height="472" data-original-width="1570" height="111" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEjuCc8GZcDFGJ1MtqZyLGVvcG46zqxiSgxKvnGjD5I3qpiCFEYfp5C1dNOSMX9FHpXCkI0oV6t783Ws141CDRXhFmWvLS1prPCHGI4j-tmwSdJY-MIMGI6A00esgrRf3_rawhCyhcp7TQ8Pw9nDBWPZl_kCYWELSnP2EmqaXyHfwJrfJYnUvFDPpuS2Nw=w369-h111" width="369" class="lazyload" data-proofer-ignore></a></div><br /><h3>Analyzing detection:</h3><p style="text-align: left;">We've inserted our encoded shellcode into an application and made it executable. So what does the Virustotal detection look like?&nbsp;</p><p style="text-align: left;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEhV-IttCZbl8lWuXtZxm8yXrfWYCr8mcoNvy_aF5I4zfRHETfNdqyuV2h9MSHfqc8ydoAHrE-cBv8QBOvC2XAEc7lPdmdt2VhPOAbVpbRVy_txu5HueHhUAykOJwgo6kHOavqtt77COPBp-TivdWpG2c1E5hrfUa_Z1yObo3Xk-UwW2K2YKZ3WdhotVSQ=s1424" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 452 204'%3E%3C/svg%3E" border="0" data-original-height="640" data-original-width="1424" height="204" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEhV-IttCZbl8lWuXtZxm8yXrfWYCr8mcoNvy_aF5I4zfRHETfNdqyuV2h9MSHfqc8ydoAHrE-cBv8QBOvC2XAEc7lPdmdt2VhPOAbVpbRVy_txu5HueHhUAykOJwgo6kHOavqtt77COPBp-TivdWpG2c1E5hrfUa_Z1yObo3Xk-UwW2K2YKZ3WdhotVSQ=w452-h204" width="452" class="lazyload" data-proofer-ignore></a></div><p><br />Just about all the vendors are detecting the invalid signature in PuTTY now since we've changed the file and the remaining vendors are detecting the unusual entry point. Compare this with the detection of the same payload encoded using Shikata Ga Nai. <br /></p><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEj-YRKbINOdGEdZCzOFaNFt37cOCNJ4yarhGryNCc4sgABICTQTaYSaYQXrYXINWcHNIrF5xZRLwpXzidVkmkyLb9dUUFSouO_iLzRq_72zBFIvwx38nRx815G6A-O-a5OPE7bwDaq1Z5ldL2mSIL-h1nLTiKpdjf6DSZuUZVaDUxjjnC7giyFi5CEjjA=s1286" style="margin-left: 1em; margin-right: 1em;" class="img-link shimmer" ><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 453 212'%3E%3C/svg%3E" border="0" data-original-height="601" data-original-width="1286" height="212" data-src="https://blogger.googleusercontent.com/img/a/AVvXsEj-YRKbINOdGEdZCzOFaNFt37cOCNJ4yarhGryNCc4sgABICTQTaYSaYQXrYXINWcHNIrF5xZRLwpXzidVkmkyLb9dUUFSouO_iLzRq_72zBFIvwx38nRx815G6A-O-a5OPE7bwDaq1Z5ldL2mSIL-h1nLTiKpdjf6DSZuUZVaDUxjjnC7giyFi5CEjjA=w453-h212" width="453" class="lazyload" data-proofer-ignore></a></div><p>We can see a big jump in detections as well as some vendors identifying the specific encoding scheme used.<br /><br /></p><p></p><p></p><p></p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Custom%20Encoding%20For%20Shellcode%20-%20Culbert%20Report&url=%2Fposts%2Fcustom-encoding-for-shellcode%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Custom%20Encoding%20For%20Shellcode%20-%20Culbert%20Report&u=%2Fposts%2Fcustom-encoding-for-shellcode%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fcustom-encoding-for-shellcode%2F&text=Custom%20Encoding%20For%20Shellcode%20-%20Culbert%20Report" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Human-Learning-Is-Irreplaceable/">Human Learning Is Irreplaceable</a><li><a href="/posts/Building-A-Detection-Lab-Around-Suricata/">Building A Detection Lab Around Suricata</a><li><a href="/posts/Making-Red-Teaming-Safer/">Making Red Teaming Safer</a><li><a href="/posts/The-evolution-of-evasion/">The Evolution Of Evasion</a><li><a href="/posts/C2-Smackdown-Empire-vs-Mythic/">C2 Smackdown Empire Vs Mythic</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/c2/">c2</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/graphana/">graphana</a> <a class="post-tag" href="/tags/jira/">jira</a> <a class="post-tag" href="/tags/nessus/">nessus</a> <a class="post-tag" href="/tags/non-technical/">non-technical</a> <a class="post-tag" href="/tags/nuages/">nuages</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Human-Learning-Is-Irreplaceable/"><div class="card-body"> <em class="small" data-ts="1759881600" data-df="ll" > Oct 8, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Human Learning Is Irreplaceable</h3><div class="text-muted small"><p> What we call “AI” is really just a cancer attacking our ability to learn and we have very little time remaining to carve it out. A note When I began writing this, it was June in Vermont and one ...</p></div></div></a></div><div class="card"> <a href="/posts/Building-A-Detection-Lab-Around-Suricata/"><div class="card-body"> <em class="small" data-ts="1720656000" data-df="ll" > Jul 11, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building A Detection Lab Around Suricata</h3><div class="text-muted small"><p> Building A Detection Lab Around Suricata A while back there were a flurry of posts from different people about how they were configuring their homelabs, rebuilding them to do X better than somet...</p></div></div></a></div><div class="card"> <a href="/posts/Making-Red-Teaming-Safer/"><div class="card-body"> <em class="small" data-ts="1707955200" data-df="ll" > Feb 15, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Making Red Teaming Safer</h3><div class="text-muted small"><p> I have been quietly hard at work the past few months turning an old project that didn’t quite work even half the time into a framework that provides the solid base of functionality required to bui...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/can-you-tell-real-from-fake-new/" class="btn btn-outline-primary" prompt="Older"><p>Can You Tell Real From Fake: Lightshot Malware Campaign</p></a> <a href="/posts/lessons-in-c2-from-cia/" class="btn btn-outline-primary" prompt="Newer"><p>Lessons In C2 From The CIA</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/c2/">c2</a> <a class="post-tag" href="/tags/container/">container</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/graphana/">graphana</a> <a class="post-tag" href="/tags/jira/">jira</a> <a class="post-tag" href="/tags/nessus/">nessus</a> <a class="post-tag" href="/tags/non-technical/">non-technical</a> <a class="post-tag" href="/tags/nuages/">nuages</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/">Matt Culbert</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
